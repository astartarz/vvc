uuid: 03444dd2-f2f7-4293-9b45-d945415c826e
langcode: en
status: true
dependencies:
  module:
    - system
id: course_search_script
label: 'Course Search Script'
code: " (function($){\n var stuff = 'morestuff';\n var apiBase = \"https://afacts-dev.oit.edu\";\n    $(function(){\n        $(\"#uxSearchCourses\").click(function(){\n            let term = $(\"#uxTerm\").val();\n            var params = {\n                subject: $(\"#uxSubject\").val(),\n                level: $(\"#uxLevel\").val(),\n                campus: $(\"#uxCampus\").val(),\n                materialCost: $(\"#uxCost\").val(),\n                startTime: $(\"#uxStartTime\").val(),\n                endTime: $(\"#uxEndTime\").val(),\n                days: $.map($(\"#uxDays :checked\"),function (box){ return $(box).val();}).join(\",\")\n\n            };\n            var esc = encodeURIComponent;            \n            var query = Object.keys(params)\n                .map(k => {return (params[k].length > 0 ? esc(k) + '=' + esc(params[k]) : \"\" );})\n                .join('&');\n            $(\"#Courses\").html('');\n            $.get(`${apiBase}/api/courses/${term}?${query}`, \"json\").done(parseCourseData).fail(function(data){});\n        });\n        //Fill dynamic fields\n        $.get(`${apiBase}/api/courses/subjects`).done(function(data){\n            data.forEach((item) => {\n                $(\"#uxSubject\").append(`<option value=\"${item.prefix}\">${item.name}</option>`)\n            });\n        });\n        $.get(`${apiBase}/api/terms`).done(function(data){\n            data.forEach((item) => {\n                $(\"#uxTerm\").append(`<option ${(item.default == \"true\" ? \"selected=\\\"selected\\\"\" : \"\")} value=\"${item.id}\">${item.description}</option>`);\n            });\n        });\n        \n    });\n    function parseCourseData(data){\n        \n        const distinct = (value, index, self) =>{\n            return self.indexOf(value) === index;\n        }\n        //get the list of unique course subject/number pairs\n        var results = \"\";\n        let courseDivisions = [];\n        data.forEach((item) =>{\n            courseDivisions.push (`${item.subjectCode}${item.courseNumber}`)\n        });\n        courseDivisions = courseDivisions.filter(distinct);\n        courseDivisions.forEach((item) =>{\n            let filteredList = data.filter((value, index) =>{\n                return (item == `${value.subjectCode}${value.courseNumber}`);\n            });\n\n            $('#Courses').append(`<div class=\"CourseCell\">${item}</div>`);\n            let coursePermutations = [];\n            filteredList.forEach((item) =>{\n                coursePermutations.push(item.title);\n            });\n            coursePermutations = coursePermutations.filter(distinct);\n            coursePermutations.forEach((item) => {\n                let filteredSubList = data.filter((value, index) => {\n                    return (item == `${value.title}`);\n                });\n                $(\"#Courses\").append(`<div class=\"CourseName group\">\n                        <div class=\"CourseNameCell\">${item}</div>\n                        <div class=\"CourseViewDescCell\"><a href=\"javascript:void(0);\" onclick=\"alert('view description');\">View Description</a></div>\n                    </div>`);\n                let table = $(`<table class=\"CourseTable footable\"><thead>\n<tr class=\"CourseHeadingRow\">\n<th class=\"footable-visible footable-first-column\">CRN</th><th class=\"footable-visible\">Sec.</th><th data-hide=\"phone,tablet\" class=\"footable-visible\">Credits</th><th class=\"footable-visible\">Days</th><th class=\"footable-visible\">Time</th><th data-hide=\"phone,tablet\" class=\"footable-visible\">Location</th><th data-hide=\"phone,tablet\" class=\"footable-visible\">Instructor</th><th class=\"footable-visible\">Status</th><th data-hide=\"phone,tablet\" class=\"footable-visible footable-last-column\">Textbook</th></tr>\n</thead><tbody></tbody></table>`);\n                filteredSubList.forEach((item) => {\n                    var days = \"\";\n                    var times = \"\";\n                    var locations = \"\";\n                    var first = false;\n                    item.schedule.forEach((scheduleItem) => {\n                        if(!first){\n                            first = true;\n                        }\n                        else{\n                            days += \"<br />\";\n                            times += \"<br />\";\n                            locations += \"<br />\";\n                        }\n                        days += scheduleItem.days;\n                        times += `${scheduleItem.startTime}-${scheduleItem.endTime}`;\n                        locations += scheduleItem.location;\n                        \n                    });\n                    let courseRow = `<tr>\n                        <td>${item.crn}</td>\n                        <td>${item.section}</td>\n                        <td>${item.creditHours}</td>\n                        <td>${days}</td>\n                        <td>${times}</td>\n                        <td>${locations}</td>\n                        <td>${item.instructor}</td>\n                        <td>${item.status} (${item.seatsTaken}/${item.seatsCapacity})</td>\n                        <td></td>\n                        </tr>`;\n                    table.find(\"tbody\").append(courseRow)\n                    \n                    \n                });\n                $('#Courses').append(table)\n                //results += table.html();\n            });\n                \n                \n                \n        });\n        \n    }\n })(jQuery);"
conditions_require_all: true
conditions:
  request_path:
    id: request_path
    pages: /academics/search-for-classes
    negate: false
contexts: {  }
header: false
preprocess: false
jquery: true
noscript: ''
noscriptRegion: {  }
